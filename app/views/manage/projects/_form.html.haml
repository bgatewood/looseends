= form_with model: @project, html: { class: 'form' } do |form|
  = render "error_messages", resource: @project
  .row.mb-4
    .col-6
      = form.label 'Give this project a name', class: 'form-label required'
      = form.text_field :name, class: 'form-control'
    .col-4
      = form.label :status, class: 'form-label'
      = form.select :status, Project::STATUSES.map{ |status| [status.humanize, status ]}, { }, { class: 'form-select' }

  .row.mb-4
    .col-6
      = form.label 'What type of craft is this?', class: 'form-label required'
      .form-info Knit, Crochet, Quilt. Do you know what it is?
      = form.text_field :craft_type, class: 'form-control'
  .row.mb-4
    .col-6
      = form.label 'What was being made?', class: 'form-label required'
      .form-info (for instance, sweater, socks, blanket, hat...)
      = form.text_area :description, size: "60x5", class: 'form-control'
  .row.mb-4
    .col-4
      = form.label 'Project Images', class: 'form-label'
      .form-info Please upload photos of the unfinished project.
      = form.file_field :append_project_images, class: 'form-control', accept: "image/png,image/gif,image/jpeg,image/webp", :multiple => true
      - form.object.project_images.each do |image|
        = image_tag image.representation( resize_to_limit: [100, 100])


  .my-4
    %h5 Mailing Address
    .form-info After it's finished, we'll send it back here
    .row.mb-3
      .col-8
        %ul.nav.nav-tabs
          %li.nav-item
            %button#usButton{:class => "nav-link #{'active' if form.object.country == 'US' || form.object.country.blank?}", :onclick => "setCountry('us')", :type => "button"} US
          %li.nav-item
            %button#caButton{:class => "nav-link #{'active' if form.object.country == 'CANADA'}", :onclick => "setCountry('ca')", :type => "button"} Canada
          %li.nav-item
            %button#otButton{:class => "nav-link #{'active' if form.object.country.present? && form.object.country != 'US' && form.object.country != 'CANADA'}", :onclick => "setCountry('ot')", :type => "button"} Not US or Canada
    #country_ui.row{ class: ("hidden" if form.object.country == 'US' || form.object.country == 'CANADA') }
      .col-4
        = form.label 'Country', class: 'form-label'
        = form.text_field :country, class: 'form-control'
    .row.my-2
      .col-8
        = form.label 'Street', class: 'form-label'
        = form.text_field :street, class: 'form-control'
    .row.my-2
      .col-8
        = form.label 'Line 2', class: 'form-label col-2'
        = form.text_field :street_2, class: 'form-control'
    .row.my-2
      .col-3
        = form.label 'City', class: 'form-label col-2'
        = form.text_field :city, class: 'form-control'
      #usState.col-3{ class: ("hidden" unless form.object.country == 'US') }
        = form.label 'State', class: 'form-label'
        = form.select :state, STATES,                      |
            { include_blank: true }, { class: 'form-select' } |
        #caState.col-3{ class: ("hidden" unless form.object.country == 'CANADA') }
        = form.label 'Province', class: 'form-label'
        = form.select :state, PROVINCES, { include_blank: true }, { class: 'form-select' }
      #otState.col-3{ class: ("hidden" if form.object.country == 'US' || form.object.country == 'CANADA') }
        = form.label 'State/Province', class: 'form-label'
        = form.text_field :state, class: 'form-control', id: 'state_ot'
      .col-2
        = form.label 'Postal code', class: 'form-label '
        = form.text_field :postal_code, class: 'form-control'

  .form-actions
    = form.submit 'Submit Project', class: "btn btn-primary"



:javascript
  const prefixes = ['us', 'ca', 'ot']

  const selectButton = (selected) => {
      prefixes.forEach(p => {
          const button = document.querySelector('#' + p + 'Button')
          if (selected === p) {
              button.classList.add('active')
          } else {
              button.classList.remove('active')
          }
      })
  };

  const showState = (selected) => {
      prefixes.forEach(p => {
          const state = document.querySelector('#' + p + 'State')
          if (selected === p) {
              state.style.display = "block"
              state.querySelector('select, input').disabled = false;
          } else {
              state.style.display = "none"
              state.querySelector('select, input').disabled = true;
              state.querySelector('select, input').value = '';
          }
      })
  };

  const showCountry = (selected) => {
      const countryinput = document.querySelector('#project_country');
      const countryField = document.querySelector('#country_ui');
      if (selected === 'us') {
          countryinput.value = 'US';
          countryField.style.display = "none"
      } else if (selected === 'ca') {
          countryinput.value = 'CANADA';
          countryField.style.display = "none"
      } else {
          countryinput.value = '';
          countryField.style.display = "block"
      }
  }

  const setCountry = (val) => {
      if (prefixes.includes(val)) {
          selectButton(val);
          showState(val);
          showCountry(val);
      } else if (val) {
          setCountry('ot')
      } else {
          setCountry('us')
      }

  }
  document.addEventListener("turbo:load", () => {
      setCountry('#{@project.country.present? ? @project.country&.downcase : ''}')
  })
